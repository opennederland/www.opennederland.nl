{% assign positions = "" | split: "" %}

{% if include.tags %}
  {% for tag in include.tags %}
    {% assign matches = site.positions | where_exp: "position", "position.tags contains tag" %}
    {% assign positions = positions | concat: matches %}
  {% endfor %}
  {% assign positions = positions | uniq %}
{% elsif include.tag %}
    {% assign positions = site.positions | where_exp: "position", "position.tags contains include.tag" %}
{% else %}
    {% assign positions = site.positions  %}
{% endif %}

<div class="initiatives-grid">
    {% for position in positions %}
    
    {% unless position.url == page.url %}
    
    <div class="initiative-card">
        
        <h3>
            <a href="{{ position.url | relative_url }}" class="initiative {{ position.slug }}">{{ position.title }}</a>
        </h3>
        <span class="year">{{ position.year }}</span>

        <div class="content">
            {{ position.content | markdownify | strip_html | truncatewords: 30 }}
        </div>

        {% if position.tags %}
        <div style="margin-top: auto; margin-bottom: 1em; padding-top: 0.5em;">
            {% for tag in position.tags %}
                <a href="{{ '/tags/' | relative_url }}{{ tag | slugify }}/" class="tag {{ tag | slugify }}" style="font-size: 0.75em; padding: 4px 8px;">
                    #{{ tag }}
                </a>
            {% endfor %}
        </div>
        {% endif %}
        
    </div>

    {% endunless %}
    {% endfor %}
</div>