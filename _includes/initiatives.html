{% assign initiatives = "" | split: "" %}

{% if include.tags %}
  {% for tag in include.tags %}
    {% assign matches = site.initiatives | where_exp: "initiative", "initiative.tags contains tag" | sort: "year" %}
    {% assign initiatives = initiatives | concat: matches %}
  {% endfor %}
  {% assign initiatives = initiatives | uniq | sort: "year" %}
{% elsif include.tag %}
    {% assign initiatives = site.initiatives | where_exp: "initiative", "initiative.tags contains include.tag" | sort: "year" %}
{% else %}
    {% assign initiatives = site.initiatives | sort: "year" %}
{% endif %}

<div class="initiatives-grid">
    {% for initiative in initiatives %}
    
    {% unless initiative.url == page.url %}
    
    <div class="initiative-card {{ initiative.tags[0] | slugify }}">
        
        <h3>
            <a href="{{ initiative.url | relative_url }}" class="initiative {{ initiative.slug }}">{{ initiative.title }}</a>
        </h3>
        <span class="year">{{ initiative.year }}</span>

        <div class="content">
            {{ initiative.content | markdownify | strip_html | truncatewords: 30 }}
        </div>

        {% if initiative.tags %}
        <div style="margin-top: auto; margin-bottom: 1em; padding-top: 0.5em;">
            {% for tag in initiative.tags %}
                <a href="{{ '/tags/' | relative_url }}{{ tag | slugify }}/" class="tag {{ tag | slugify }}" style="font-size: 0.75em; padding: 4px 8px;">
                    #{{ tag }}
                </a>
            {% endfor %}
        </div>
        {% endif %}

        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            
            {% if initiative.website %}
                <a href="{{ initiative.website }}" target="_blank" style="font-size: 0.9em; color: #888; text-decoration: none;">
                    Website â†—
                </a>
            {% endif %}
        </div>
        
    </div>

    {% endunless %}
    {% endfor %}
</div>