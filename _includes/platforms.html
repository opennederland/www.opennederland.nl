{% assign platforms = "" | split: "" %}

{% if include.tags %}
  {% for tag in include.tags %}
    {% assign matches = site.platforms | where_exp: "platform", "platform.tags contains tag" | sort: "year" %}
    {% assign platforms = platforms | concat: matches %}
  {% endfor %}
  {% assign platforms = platforms | uniq | sort: "year" %}
{% elsif include.tag %}
    {% assign platforms = site.platforms | where_exp: "platform", "platform.tags contains include.tag" | sort: "year" %}
{% else %}
    {% assign platforms = site.platforms | sort: "year" %}
{% endif %}

<div class="initiatives-grid">
    {% for platform in platforms %}
    
    {% unless platform.url == page.url %}
    
    <div class="initiative-card">
        
        <h3>
            <a href="{{ platform.url | relative_url }}" class="platform {{ platform.slug }}">{{ platform.title }}</a>
        </h3>
        
        <div style="font-size: 0.85em; color: #666; margin-bottom: 0.5em;">
            <span class="year">{{ platform.year }}</span>
            {% if platform.type %}
                &bull; <span class="type">{{ platform.type }}</span>
            {% endif %}
        </div>

        <div class="content">
            {{ platform.content | markdownify | strip_html | truncatewords: 30 }}
        </div>

        {% if platform.tags %}
        <div style="margin-top: auto; margin-bottom: 1em; padding-top: 0.5em;">
            {% for tag in platform.tags %}
                <a href="{{ '/tags/' | relative_url }}{{ tag | slugify }}/" class="tag {{ tag | slugify }}" style="font-size: 0.75em; padding: 4px 8px;">
                    #{{ tag }}
                </a>
            {% endfor %}
        </div>
        {% endif %}

        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            {% if platform.website %}
                <a href="{{ platform.website }}" target="_blank" style="font-size: 0.9em; color: #888; text-decoration: none;">
                    Website â†—
                </a>
            {% endif %}
        </div>
        
    </div>

    {% endunless %}
    {% endfor %}
</div>